{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"SCHISM-ESMF","text":"<p>The Earth System Modeling Framework (ESMF) and National Unified Operational Prediction Capability (NUOPC) caps for SCHISM.</p>"},{"location":"index.html#three-steps","title":"Three steps","text":"<p>The cap is meant to be used in the context of ESMF-based coupling frameworks, which come in two flavors, either based on ESMF or on its NUOPC extension. We also provide some standalone example applications which you can use to base your own implementation on</p> <ol> <li>Install the prerequisites following Installation</li> <li>Build the cap's ESMF and NUOPC libraries following Installation</li> <li>Include the SCHISM-ESMF cap in your application's build system by linking to <code>-libschism_esmf</code>, see below</li> </ol>"},{"location":"index.html#coupling-frameworks","title":"Coupling frameworks","text":""},{"location":"index.html#nuopc","title":"NUOPC","text":"<p>The National Unified Operational Prediction Capability (NUOPC) is a consortium of Navy, NOAA, and Air Force modelers and their research partners. It aims to advance the weather prediction modeling systems used by meteorologists, mission planners, and decision makers. NUOPC partners are working toward a common model architecture - a standard way of building models - in order to make it easier to collaboratively build modeling systems. To this end, they have developed the NUOPC Layer that defines conventions and a set of generic components for building coupled models using the Earth System Modeling Framework (ESMF).</p> <p>SCHISM can be such a model component within an NUOPC-coupled system.  A so-called \"cap\" wraps SCHISM and exposes it via the NUOPC Application Programming Interface (API).  The interfaces exposed through the API are  * import of fields  * export of fields  * control structure</p>"},{"location":"index.html#nuopc-coastalapp","title":"NUOPC - CoastalApp","text":"<p>The NOAA Environmental Modeling System (NEMS) Coastal Application \"CoastalApp\" is a NUOPC-based coupled system using the NEMS coupler.</p> <p>The NUOPC cap is currently being integrated as an OCN component of the CoastalApp; this is available from a public repository https://github.com/noaa-ocs-modeling/CoastalApp</p>"},{"location":"index.html#obtaining-and-building-coastalapp","title":"Obtaining and building CoastalApp","text":"<pre><code>export COASTALAPP_DIR=/my/path/to/coastalapp\ngit clone https://github.com/noaa-ocs-modeling/CoastalApp $COASTALAPP_DIR\ncd $COASTALAPP_DIR\ngit checkout feature/schism\ngit submodule update --init --recursive SCHISM NEMS\nbash ./build.sh -component \"SCHISM\"\n</code></pre> <p>You can add components like <code>WW3</code> or <code>ADCIRC</code>, and you may be required to choose a compiler or platform.  Consult <code>./build.sh -h</code> for help and further information.</p>"},{"location":"index.html#esmf","title":"ESMF","text":"<p>The Earth System Modeling Framework (ESMF) is a suite of software tools for developing high-performance, multi-component Earth science modeling applications. Such applications may include a few or dozens of components representing atmospheric, oceanic, terrestrial, or other physical domains, and their constituent processes (dynamical, chemical, biological, etc.). Often these components are developed by different groups independently, and must be \u201ccoupled\u201d together using software that transfers and transforms data among the components in order to form functional simulations.</p> <p>SCHISM can be such a component within an ESMF-coupled system.  A so-called \"cap\" wraps SCHISM and exposes it via the ESMF Application Programming Interface (API).  The interfaces exposed through the API are  * import of fields  * export of fields  * control structure</p>"},{"location":"index.html#esmf-mossco","title":"ESMF - MOSSCO","text":"<p>MOSSCO, the \"Modular System for Shelves and Coasts\" is a framework for coupling processes or domains that are originally developed in standalone numerical models. The software MOSSCO implements this infrastructure in the form of a library of components and couplers, and of example coupled applications. The components \"wrap\" external models used in coastal and shelf sciences; these wrapped components are then coupled to each other in the Earth System Modeling Framework (ESMF).</p> <p>The SCHISM ESMF cap integrates with MOSSCO.</p>"},{"location":"index.html#obtaining-and-building-mossco","title":"Obtaining and building MOSSCO","text":"<pre><code>export SCHISM_BUILD_DIR=/my/path/to/schism/build\nexport SCHISM_ESMF_DIR=/my/path/to/schism-esmf\nexport MOSSCO_DIR=/my/path/to/mossco\n\ngit clone https://git.code.sf.net/p/mossco/code $MOSSCO_DIR\n\ncd $MOSSCO_DIR\nmake all install\n\nbash ./build.sh -component \"SCHISM\"\n</code></pre>"},{"location":"index.html#using-schism-as-part-of-a-mossco-coupled-system","title":"Using SCHISM as part of a MOSSCO coupled system","text":"<p>A simple preconfigured application is available in <code>$MOSSCO_DIR/examples/esmf/schism</code>. To build it, run <code>make</code> in that directory.  You can use the resulting executable as a drop-in replacement for SCHISM's standalone <code>pschism</code> executable, but you need to add the <code>mossco.cfg</code> resource file which overrides <code>param.nml</code> for control parameters of the coupled system, like start and stop time.</p>"},{"location":"index.html#esmf-pre-configured-executables","title":"ESMF - Pre-configured executables","text":"<p>While the API exposed through the SCHISM-ESMF library is the core functionality of the cap, there are also several  pre-configured simple coupled systems available for you to  <code>make</code> or use as a template:</p> <pre><code>concurrent_esmf_test.F90\nmulti_schism.F90\nschism_driver_interfaces.F90\nschism_pdaf.F90\ntriple_schism.F90\n</code></pre>"},{"location":"index.html#applications","title":"Applications","text":"<p>(1) The SCHISM ESMF cap is used to couple SCHISM to the Parallel Data Assimilation Framework leveraging the control structures of ESMF, see <code>schism_pdaf.F90</code>.</p> <p>(2) The SCHISM ESMF cap is used in the Modular System for Shelves and Coasts (MOSSCO). Within that system, SCHISM can be flexibly coupled to components for the atmosphere, waves, ocean BGC, generic input/output, sediment.</p>"},{"location":"index.html#publications","title":"Publications","text":"<p>Hao-Cheng Yu, Yinglong J. Zhang, Nerger Lars, Carsten Lemmen, Jason C.S Yu, Tzu-Yin Chou, Chi-Hao Chu, and Chuen-Teyr Terng: Development of a flexible data assimilation method in a 3D unstructured-grid ocean model under Earth System Modeling Framework, submitted to Geoscientific Model Development, March 2022</p>"},{"location":"BuildingDocs.html","title":"Documentation Build Guide","text":"<p>This document explains how to build and work with the SCHISM-ESMF documentation.</p>"},{"location":"BuildingDocs.html#overview","title":"Overview","text":"<p>The project documentation is built using MkDocs with the Material theme. The documentation sources are in Markdown format located in the <code>doc/</code> directory.</p>"},{"location":"BuildingDocs.html#documentation-structure","title":"Documentation Structure","text":"<pre><code>schism-esmf/\n\u251c\u2500\u2500 doc/                          # Documentation source files\n\u2502   \u251c\u2500\u2500 index.md                  # Homepage\n\u2502   \u251c\u2500\u2500 installation.md           # Installation guide\n\u2502   \u251c\u2500\u2500 cmake-architecture.md     # CMake build system details\n\u2502   \u251c\u2500\u2500 running-examples.md       # How to run examples\n\u2502   \u251c\u2500\u2500 legal.md                  # License and legal information\n\u2502   \u251c\u2500\u2500 logo.png                  # Project logo\n\u2502   \u2514\u2500\u2500 CMakeLists.txt            # CMake build rules for docs\n\u251c\u2500\u2500 mkdocs.yml                    # MkDocs configuration\n\u251c\u2500\u2500 Readme.md                     # Main project README (linked in docs)\n\u251c\u2500\u2500 QUICKSTART.md                 # Quick start guide (linked in docs)\n\u2514\u2500\u2500 .github/\n    \u2514\u2500\u2500 BUILD_TROUBLESHOOTING.md  # Build troubleshooting (linked in docs)\n</code></pre>"},{"location":"BuildingDocs.html#prerequisites","title":"Prerequisites","text":""},{"location":"BuildingDocs.html#required","title":"Required","text":"<ul> <li>Python 3.8+</li> <li>MkDocs: <code>pip install mkdocs</code></li> <li>MkDocs Material theme: <code>pip install mkdocs-material</code></li> </ul>"},{"location":"BuildingDocs.html#installation-options","title":"Installation Options","text":""},{"location":"BuildingDocs.html#using-pip-recommended","title":"Using pip (recommended)","text":"<pre><code>pip install mkdocs mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#using-condamamba","title":"Using conda/mamba","text":"<pre><code>conda install -c conda-forge mkdocs mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#using-poetry-for-developers","title":"Using Poetry (for developers)","text":"<pre><code>poetry install\n</code></pre>"},{"location":"BuildingDocs.html#building-documentation","title":"Building Documentation","text":""},{"location":"BuildingDocs.html#using-cmake-integrated-build","title":"Using CMake (Integrated Build)","text":"<p>The documentation build is integrated into the CMake build system.</p>"},{"location":"BuildingDocs.html#enable-documentation-build","title":"Enable Documentation Build","text":"<pre><code>mkdir -p build &amp;&amp; cd build\ncmake .. -DBUILD_DOCS=ON\n</code></pre>"},{"location":"BuildingDocs.html#build-html-documentation","title":"Build HTML Documentation","text":"<pre><code>make docs\n</code></pre> <p>The built documentation will be in <code>build/docs/</code>.</p>"},{"location":"BuildingDocs.html#serve-documentation-locally","title":"Serve Documentation Locally","text":"<pre><code>make docs-serve\n</code></pre> <p>This starts a local web server at http://127.0.0.1:8000 with live reloading.</p>"},{"location":"BuildingDocs.html#clean-documentation","title":"Clean Documentation","text":"<pre><code>make docs-clean\n</code></pre>"},{"location":"BuildingDocs.html#using-mkdocs-directly","title":"Using MkDocs Directly","text":"<p>You can also build documentation directly with MkDocs without CMake:</p>"},{"location":"BuildingDocs.html#build","title":"Build","text":"<pre><code>mkdocs build\n</code></pre> <p>Output goes to <code>site/</code> directory.</p>"},{"location":"BuildingDocs.html#serve-locally","title":"Serve Locally","text":"<pre><code>mkdocs serve\n</code></pre> <p>Navigate to http://127.0.0.1:8000 to view.</p>"},{"location":"BuildingDocs.html#build-for-deployment","title":"Build for Deployment","text":"<pre><code>mkdocs build --strict\n</code></pre> <p>The <code>--strict</code> flag treats warnings as errors.</p>"},{"location":"BuildingDocs.html#cmake-integration-details","title":"CMake Integration Details","text":""},{"location":"BuildingDocs.html#build-option","title":"Build Option","text":"<p>The documentation build is controlled by the <code>BUILD_DOCS</code> CMake option:</p> <pre><code>option(BUILD_DOCS \"Build HTML documentation with MkDocs\" OFF)\n</code></pre> <p>It's OFF by default to avoid requiring Python/MkDocs for users who only want to build the software.</p>"},{"location":"BuildingDocs.html#docs-only-configure-no-fortranmpi-required","title":"Docs-only Configure (no Fortran/MPI required)","text":"<p>If your Fortran/MPI toolchain isn't available, you can configure a documentation-only build:</p> <pre><code>mkdir -p build &amp;&amp; cd build\ncmake .. -DDOCS_ONLY=ON  # Implicitly sets -DBUILD_DOCS=ON\ncmake --build . --target docs\n</code></pre>"},{"location":"BuildingDocs.html#cmake-targets","title":"CMake Targets","text":"Target Description <code>docs</code> Build HTML documentation <code>docs-serve</code> Start local documentation server <code>docs-clean</code> Remove built documentation"},{"location":"BuildingDocs.html#installation","title":"Installation","text":"<p>When you run <code>make install</code>, the documentation is installed to:</p> <ul> <li>HTML documentation: <code>${CMAKE_INSTALL_PREFIX}/share/doc/SCHISM_ESMF_Interface/html/</code></li> <li>Markdown sources: <code>${CMAKE_INSTALL_PREFIX}/share/doc/SCHISM_ESMF_Interface/markdown/</code></li> <li>Top-level docs: <code>${CMAKE_INSTALL_PREFIX}/share/doc/SCHISM_ESMF_Interface/</code> (Readme.md, QUICKSTART.md)</li> </ul> <p>Example:</p> <pre><code>cmake .. -DBUILD_DOCS=ON -DCMAKE_INSTALL_PREFIX=/usr/local\nmake docs\nsudo make install\n</code></pre>"},{"location":"BuildingDocs.html#continuous-integration","title":"Continuous Integration","text":""},{"location":"BuildingDocs.html#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>name: Build Documentation\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n\njobs:\n  docs:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: |\n          pip install mkdocs mkdocs-material\n\n      - name: Build documentation\n        run: mkdocs build --strict\n\n      - name: Deploy to GitHub Pages\n        if: github.ref == 'refs/heads/main'\n        run: mkdocs gh-deploy --force\n</code></pre>"},{"location":"BuildingDocs.html#github-pages-deployment","title":"GitHub Pages Deployment","text":"<p>To deploy documentation to GitHub Pages:</p> <pre><code>mkdocs gh-deploy\n</code></pre> <p>This builds and pushes the documentation to the <code>gh-pages</code> branch.</p>"},{"location":"BuildingDocs.html#writing-documentation","title":"Writing Documentation","text":""},{"location":"BuildingDocs.html#file-format","title":"File Format","text":"<p>All documentation files are Markdown (<code>.md</code>) with YAML front matter:</p> <pre><code>---\ntitle: Page Title\nsummary: Brief description\n---\n\n# Main Heading\n\nContent here...\n</code></pre>"},{"location":"BuildingDocs.html#code-blocks","title":"Code Blocks","text":"<p>Use fenced code blocks with language specification:</p> <pre><code>```python\ndef hello():\n    print(\"Hello, SCHISM!\")\n```\n</code></pre>"},{"location":"BuildingDocs.html#admonitions","title":"Admonitions","text":"<p>Use Material theme admonitions for callouts:</p> <pre><code>!!! note \"Important Note\"\n    This is an important note.\n\n!!! warning\n    This is a warning.\n\n!!! tip\n    This is a helpful tip.\n</code></pre>"},{"location":"BuildingDocs.html#internal-links","title":"Internal Links","text":"<p>Link to other documentation pages:</p> <pre><code>See [Installation Guide](installation.md) for details.\n</code></pre>"},{"location":"BuildingDocs.html#external-links","title":"External Links","text":"<p>Link to GitHub files:</p> <pre><code>See [BUILD_TROUBLESHOOTING.md](../.github/BUILD_TROUBLESHOOTING.md).\n</code></pre>"},{"location":"BuildingDocs.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"BuildingDocs.html#python-not-found","title":"Python Not Found","text":"<p>Problem: <code>Python3 not found</code> during CMake configure.</p> <p>Solution: Install Python 3.8+ and ensure it's in your PATH.</p> <pre><code># macOS\nbrew install python@3.11\n\n# Ubuntu/Debian\nsudo apt install python3 python3-pip\n\n# Windows\n# Download from python.org\n</code></pre>"},{"location":"BuildingDocs.html#mkdocs-not-found","title":"MkDocs Not Found","text":"<p>Problem: <code>MkDocs not found</code> warning during CMake configure.</p> <p>Solution: Install MkDocs:</p> <pre><code>pip install mkdocs mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#material-theme-not-found","title":"Material Theme Not Found","text":"<p>Problem: <code>MkDocs Material theme not found</code> warning.</p> <p>Solution: Install the Material theme:</p> <pre><code>pip install mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#build-fails-with-import-errors","title":"Build Fails with Import Errors","text":"<p>Problem: Documentation build fails with Python import errors.</p> <p>Solution: Check that all required packages are installed:</p> <pre><code>python3 -c \"import mkdocs; print(mkdocs.__version__)\"\npython3 -c \"import material; print(material.__version__)\"\n</code></pre> <p>If either fails, reinstall:</p> <pre><code>pip install --upgrade mkdocs mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#documentation-doesnt-update","title":"Documentation Doesn't Update","text":"<p>Problem: Changes to markdown files don't appear in built docs.</p> <p>Solution:  1. Clean the build: <code>make docs-clean</code> or <code>rm -rf site/</code> 2. Rebuild: <code>make docs</code> or <code>mkdocs build</code></p> <p>When using <code>mkdocs serve</code>, changes should auto-reload. If not, restart the server.</p>"},{"location":"BuildingDocs.html#configuration-reference","title":"Configuration Reference","text":""},{"location":"BuildingDocs.html#mkdocsyml-structure","title":"mkdocs.yml Structure","text":"<pre><code>site_name: Project Name           # Site title\nsite_url: https://example.com     # Base URL\ndocs_dir: ./doc                   # Source directory\nsite_dir: ./site                  # Output directory\ntheme:\n  name: material                  # Theme name\n  features: [...]                 # Theme features\nnav:                              # Navigation structure\n  - Home: index.md\n  - Guide: guide.md\nmarkdown_extensions: [...]        # Markdown processing extensions\nplugins: [...]                    # MkDocs plugins\n</code></pre>"},{"location":"BuildingDocs.html#material-theme-features","title":"Material Theme Features","text":"<p>Enabled features in <code>mkdocs.yml</code>:</p> <ul> <li><code>toc.integrate</code> - Integrate table of contents into navigation</li> <li><code>toc.follow</code> - Follow active item in ToC</li> <li><code>content.code.annotate</code> - Code annotation support</li> <li><code>navigation.tabs</code> - Top-level navigation tabs</li> <li><code>navigation.sections</code> - Group pages into sections</li> <li><code>navigation.expand</code> - Expand sections by default</li> <li><code>navigation.top</code> - \"Back to top\" button</li> <li><code>search.suggest</code> - Search suggestions</li> <li><code>search.highlight</code> - Highlight search terms</li> </ul>"},{"location":"BuildingDocs.html#markdown-extensions","title":"Markdown Extensions","text":"<p>Key extensions enabled:</p> <ul> <li><code>admonition</code> - Note/warning boxes</li> <li><code>codehilite</code> - Syntax highlighting</li> <li><code>pymdownx.superfences</code> - Nested code blocks</li> <li><code>pymdownx.tabbed</code> - Tabbed content</li> <li><code>pymdownx.details</code> - Collapsible sections</li> </ul>"},{"location":"BuildingDocs.html#best-practices","title":"Best Practices","text":"<ol> <li>Keep files focused: Each page should cover one topic</li> <li>Use clear headings: Hierarchical structure with H1, H2, H3</li> <li>Test locally: Always run <code>mkdocs serve</code> to preview changes</li> <li>Link generously: Cross-link related content</li> <li>Use code examples: Show, don't just tell</li> <li>Add screenshots: Visual aids help comprehension (when applicable)</li> <li>Update navigation: Add new pages to <code>mkdocs.yml</code> nav section</li> <li>Follow naming conventions: Use lowercase-with-hyphens for filenames</li> </ol>"},{"location":"BuildingDocs.html#maintenance","title":"Maintenance","text":""},{"location":"BuildingDocs.html#updating-dependencies","title":"Updating Dependencies","text":"<p>Check for MkDocs updates:</p> <pre><code>pip list --outdated | grep mkdocs\n</code></pre> <p>Update:</p> <pre><code>pip install --upgrade mkdocs mkdocs-material\n</code></pre>"},{"location":"BuildingDocs.html#checking-for-broken-links","title":"Checking for Broken Links","text":"<p>Install link checker:</p> <pre><code>pip install linkchecker\n</code></pre> <p>Check built docs:</p> <pre><code>mkdocs build\nlinkchecker site/\n</code></pre>"},{"location":"BuildingDocs.html#documentation-review-checklist","title":"Documentation Review Checklist","text":"<p>Before committing documentation changes:</p> <ul> <li>[ ] Spell-check content</li> <li>[ ] Verify all links work</li> <li>[ ] Build with <code>--strict</code> flag passes</li> <li>[ ] Preview with <code>mkdocs serve</code> looks correct</li> <li>[ ] Code examples are tested and correct</li> <li>[ ] Navigation updated if new pages added</li> <li>[ ] Front matter (title, summary) is accurate</li> </ul>"},{"location":"BuildingDocs.html#resources","title":"Resources","text":"<ul> <li>MkDocs Documentation</li> <li>Material for MkDocs</li> <li>Markdown Guide</li> <li>PyMdown Extensions</li> </ul>"},{"location":"BuildingDocs.html#getting-help","title":"Getting Help","text":"<ul> <li>MkDocs Issues: https://github.com/mkdocs/mkdocs/issues</li> <li>Material Theme Issues: https://github.com/squidfunk/mkdocs-material/issues</li> <li>Project Docs Issues: https://github.com/schism-dev/schism-esmf/issues</li> </ul> <p>Last Updated: November 2025 Maintainer: Carsten Lemmen carsten.lemmen@hereon.de</p>"},{"location":"build-troubleshooting.html","title":"Build Troubleshooting","text":"<p>For the complete list of known build issues with solutions and diagnostics, see the central troubleshooting document in the repository:</p> <ul> <li>View full troubleshooting: https://github.com/schism-dev/schism-esmf/blob/HEAD/.github/BUILD_TROUBLESHOOTING.md</li> </ul> <p>Quick tips:</p> <ul> <li>Ensure ESMF is built with real MPI (not mpiuni)</li> <li>Verify SCHISM_BUILD_DIR points to a valid build with required libraries</li> <li>Use <code>cmake --build . -- VERBOSE=1</code> to diagnose link errors</li> <li>Run <code>.github/test-cmake-instructions.sh</code> to validate your environment</li> </ul>"},{"location":"cmake-architecture.html","title":"CMake Build System Architecture","text":"<p>This document explains the CMake build system design for schism-esmf, focusing on the patterns and conventions used to handle complex Fortran module dependencies.</p>"},{"location":"cmake-architecture.html#overview","title":"Overview","text":"<p>The schism-esmf build system creates: - Libraries: <code>libschism_interface_common.a</code>, <code>libschism_esmf_interface.a</code>, <code>libschism_nuopc_interface.a</code>, <code>libschism_model_libs.a</code>, <code>libschism_driver_libs.a</code> - Executables: <code>main_esmf</code>, <code>main_nuopc</code></p>"},{"location":"cmake-architecture.html#directory-structure","title":"Directory Structure","text":"<pre><code>CMakeLists.txt           # Top-level: ESMF/SCHISM discovery, installation\ncmake/\n  FindESMF.cmake         # Custom module to parse esmf.mk\n  ConfigureESMF.cmake    # ESMF validation and warnings\n  compilers.cmake        # Compiler-specific flags (optional)\nsrc/\n  CMakeLists.txt         # Main executables, module directory setup\n  schism/\n    CMakeLists.txt       # Interface libraries (ESMF/NUOPC caps)\n  model/\n    CMakeLists.txt       # Atmosphere CMI implementations\n  driver/\n    CMakeLists.txt       # Toplevel drivers\n  PDAF_bindings/         # Optional: data assimilation\n  mossco/                # Optional: MOSSCO integration\n</code></pre>"},{"location":"cmake-architecture.html#key-architectural-patterns","title":"Key Architectural Patterns","text":""},{"location":"cmake-architecture.html#1-shared-source-pattern-schism_interface_common","title":"1. Shared Source Pattern (<code>schism_interface_common</code>)","text":"<p>Problem: Both <code>schism_esmf_interface</code> and <code>schism_nuopc_interface</code> need to compile the same source files (<code>schism_bmi.F90</code>, <code>schism_esmf_util.F90</code>). When building in parallel, both targets try to create identical <code>.mod</code> files simultaneously, causing race conditions:</p> <pre><code>Error copying Fortran module \"schism_bmi.mod\"\nCannot rename module file 'schism_bmi.mod0' to 'schism_bmi.mod'\n</code></pre> <p>Solution: Create a separate library for common sources that both interface libraries depend on:</p> <pre><code># src/schism/CMakeLists.txt\n\n# Compile common sources exactly once\nadd_library(schism_interface_common STATIC\n    schism_bmi.F90\n    schism_esmf_util.F90\n)\n\nset_target_properties(schism_interface_common PROPERTIES\n    Fortran_MODULE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY}\n)\n\n# ESMF interface depends on common library\nadd_library(schism_esmf_interface STATIC\n    schism_esmf_cap.F90\n)\ntarget_link_libraries(schism_esmf_interface PUBLIC schism_interface_common)\n\n# NUOPC interface depends on common library\nadd_library(schism_nuopc_interface STATIC\n    schism_nuopc_util.F90\n    schism_nuopc_cap.F90\n)\ntarget_link_libraries(schism_nuopc_interface PUBLIC schism_interface_common)\n</code></pre> <p>Benefits: - \u2705 Common sources compiled exactly once - \u2705 Modules generated once and shared - \u2705 No parallel build race conditions - \u2705 Clear dependency graph - \u2705 Faster builds (less compilation)</p>"},{"location":"cmake-architecture.html#2-centralized-fortran-module-directory","title":"2. Centralized Fortran Module Directory","text":"<p>Problem: Fortran <code>.mod</code> files must be found by consumers. By default, CMake generates them in each target's build directory, requiring complex include path management.</p> <p>Solution: Set <code>CMAKE_Fortran_MODULE_DIRECTORY</code> globally and per-target:</p> <pre><code># src/CMakeLists.txt\n\n# Set centralized module directory\nset(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR}/modules)\nfile(MAKE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY})\n\n# Ensure all targets use it\nadd_subdirectory(schism)\nadd_subdirectory(model)\nadd_subdirectory(driver)\n\n# Make modules visible to executables\ntarget_include_directories(main_esmf PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY})\ntarget_include_directories(main_nuopc PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY})\n</code></pre> <p>Per-target enforcement: <pre><code>set_target_properties(schism_interface_common PROPERTIES\n    Fortran_MODULE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY}\n)\n</code></pre></p> <p>Benefits: - \u2705 Single location for all <code>.mod</code> files - \u2705 Simplified include paths - \u2705 Easier debugging (one place to check) - \u2705 Consistent module handling</p>"},{"location":"cmake-architecture.html#3-dependency-chain","title":"3. Dependency Chain","text":"<p>The build system links libraries in a specific order to resolve symbols:</p> <pre><code>main_esmf/main_nuopc\n  \u2193\nschism_driver_libs (toplevel_schism_atm, driver_schism)\n  \u2193\nschism_model_libs (atmosphere_cmi_esmf, atmosphere_cmi_nuopc)\n  \u2193\nschism_esmf_interface/schism_nuopc_interface (ESMF caps)\n  \u2193\nschism_interface_common (BMI, utilities)\n  \u2193\nSCHISM_LIBRARIES (core, hydro, turbulence, yaml, parmetis, metis)\n  \u2193\nMPI_Fortran_LIBRARIES (mpi_mpich, pmpi_mpich)\n  \u2193\nESMF::ESMF (libesmf, pio, netcdf)\n</code></pre> <p>Implementation in <code>src/CMakeLists.txt</code>: <pre><code># Add subdirectories first (creates targets)\nadd_subdirectory(schism)\nadd_subdirectory(model)\nadd_subdirectory(driver)\n\n# Link executables to libraries (order matters for static libs)\ntarget_link_libraries(main_esmf PRIVATE\n    schism_driver_libs\n    schism_model_libs\n    schism_esmf_interface\n    ESMF::ESMF\n)\n\ntarget_link_libraries(main_nuopc PRIVATE\n    schism_driver_libs\n    schism_model_libs\n    schism_nuopc_interface\n    ESMF::ESMF\n)\n</code></pre></p> <p>Why order matters: With static libraries, the linker processes libraries left-to-right. Symbols are only resolved from libraries that come after the object files/libraries that need them. This is why <code>ESMF::ESMF</code> comes last \u2014 it provides symbols needed by all the schism libraries.</p>"},{"location":"cmake-architecture.html#4-schism-dependency-discovery","title":"4. SCHISM Dependency Discovery","text":"<p>Problem: SCHISM is built separately and provides multiple libraries. CMake needs to discover and link all of them.</p> <p>Solution: Loop through known library names and accumulate found libraries:</p> <pre><code># Top-level CMakeLists.txt\n\nset(SCHISM_LIBRARY_DIR \"${SCHISM_BUILD_DIR}/lib\")\nset(SCHISM_INCLUDE_DIR \"${SCHISM_BUILD_DIR}/include\")\n\nset(SCHISM_LIBRARIES \"\")\nforeach(LIB core hydro turbulence yaml parmetis metis)\n  find_library(SCHISM_${LIB}_PATH\n    NAMES ${LIB}\n    HINTS ${SCHISM_LIBRARY_DIR}\n    NO_DEFAULT_PATH\n  )\n  if(SCHISM_${LIB}_PATH)\n    list(APPEND SCHISM_LIBRARIES ${SCHISM_${LIB}_PATH})\n    message(STATUS \"Found SCHISM library: ${SCHISM_${LIB}_PATH}\")\n  else()\n    message(WARNING \"SCHISM library ${LIB} not found in ${SCHISM_LIBRARY_DIR}\")\n  endif()\nendforeach()\n\n# Also need MPI libraries\nfind_package(MPI REQUIRED COMPONENTS Fortran)\nif(MPI_Fortran_FOUND)\n  list(APPEND SCHISM_LIBRARIES ${MPI_Fortran_LIBRARIES})\nendif()\n</code></pre> <p>Benefits: - \u2705 Automatic discovery of available libraries - \u2705 Clear warning for missing libraries - \u2705 Flexible (works with different SCHISM builds) - \u2705 MPI properly linked</p>"},{"location":"cmake-architecture.html#5-esmf-configuration","title":"5. ESMF Configuration","text":"<p>Problem: ESMF is installed externally and provides configuration via <code>esmf.mk</code> makefile fragment, not CMake config.</p> <p>Solution: Custom <code>FindESMF.cmake</code> module parses <code>esmf.mk</code>:</p> <pre><code># cmake/FindESMF.cmake\n\n# Find esmf.mk\nfind_file(ESMF_MK_FILE\n  NAMES esmf.mk\n  HINTS ${ESMFMKFILE} ENV ESMFMKFILE\n  PATH_SUFFIXES lib\n)\n\n# Parse variables from esmf.mk\nfile(STRINGS \"${ESMF_MK_FILE}\" _esmf_version_line REGEX \"^ESMF_VERSION_STRING=\")\nstring(REGEX REPLACE \"^ESMF_VERSION_STRING=([0-9.]+).*\" \"\\\\1\" ESMF_VERSION \"${_esmf_version_line}\")\n\n# Parse compile options (must use separate_arguments!)\nset(_esmf_opts_string \"${ESMF_F90COMPILEOPTS} ${ESMF_F90COMPILEFREECPP}\")\nseparate_arguments(_esmf_opts_list UNIX_COMMAND \"${_esmf_opts_string}\")\nset(ESMF_COMPILE_OPTIONS ${_esmf_opts_list})\n\n# Create imported target\nadd_library(ESMF::ESMF INTERFACE IMPORTED)\nset_target_properties(ESMF::ESMF PROPERTIES\n  INTERFACE_INCLUDE_DIRECTORIES \"${ESMF_INCLUDE_DIRS}\"\n  INTERFACE_LINK_LIBRARIES \"${ESMF_LIBRARIES}\"\n  INTERFACE_COMPILE_OPTIONS \"${ESMF_COMPILE_OPTIONS}\"\n)\n</code></pre> <p>Critical detail: Use <code>separate_arguments()</code> to properly parse space-separated compiler flags. Passing them as a single string causes compilation errors.</p>"},{"location":"cmake-architecture.html#build-process-flow","title":"Build Process Flow","text":"<ol> <li>Configuration (<code>cmake ..</code>):</li> <li>Find ESMF via <code>$ESMFMKFILE</code></li> <li>Parse <code>esmf.mk</code> and create <code>ESMF::ESMF</code> target</li> <li>Find SCHISM libraries in <code>$SCHISM_BUILD_DIR/lib</code></li> <li>Discover MPI libraries</li> <li>Set up module directory</li> <li> <p>Configure subdirectories</p> </li> <li> <p>Generation (<code>cmake --build .</code>):</p> </li> <li>Generate build files (Makefiles or Ninja)</li> <li> <p>Create <code>build/modules/</code> directory</p> </li> <li> <p>Compilation:</p> </li> <li>Build <code>schism_interface_common</code> first (15%)</li> <li>Build <code>schism_nuopc_interface</code> and <code>schism_esmf_interface</code> in parallel (31%, 42%)</li> <li>Build <code>schism_model_libs</code> (52%)</li> <li>Build <code>schism_driver_libs</code> (84%)</li> <li>Compile <code>main_esmf.F90</code> and <code>main_nuopc.F90</code> (92%)</li> <li> <p>Link executables (100%)</p> </li> <li> <p>Linking:</p> </li> <li>Linker processes libraries in dependency order</li> <li>Resolves symbols from SCHISM, MPI, and ESMF</li> <li>Creates final executables</li> </ol>"},{"location":"cmake-architecture.html#common-pitfalls-and-solutions","title":"Common Pitfalls and Solutions","text":""},{"location":"cmake-architecture.html#pitfall-module-file-not-found","title":"Pitfall: \"Module file not found\"","text":"<p>Cause: Target doesn't depend on library that creates the module.</p> <p>Fix: Use <code>target_link_libraries()</code> to create dependency: <pre><code>target_link_libraries(schism_model_libs PUBLIC schism_esmf_interface)\n</code></pre></p>"},{"location":"cmake-architecture.html#pitfall-undefined-symbols-at-link-time","title":"Pitfall: \"Undefined symbols\" at link time","text":"<p>Cause: Library not linked or wrong link order.</p> <p>Fix: Add missing library to <code>SCHISM_LIBRARIES</code> or <code>target_link_libraries()</code>.</p>"},{"location":"cmake-architecture.html#pitfall-parallel-build-fails-with-module-errors","title":"Pitfall: Parallel build fails with module errors","text":"<p>Cause: Multiple targets compiling same source files.</p> <p>Fix: Extract common sources into separate library (see Pattern #1).</p>"},{"location":"cmake-architecture.html#pitfall-unrecognized-command-line-option","title":"Pitfall: \"Unrecognized command-line option\"","text":"<p>Cause: ESMF compile options passed as single quoted string.</p> <p>Fix: Use <code>separate_arguments()</code> in FindESMF.cmake.</p>"},{"location":"cmake-architecture.html#testing-the-build-system","title":"Testing the Build System","text":"<p>Run the validation script: <pre><code>.github/test-cmake-instructions.sh\n</code></pre></p> <p>This checks: - ESMF configuration and MPI support - SCHISM library availability - Compiler configuration - CMake configuration validity</p>"},{"location":"cmake-architecture.html#extending-the-build-system","title":"Extending the Build System","text":""},{"location":"cmake-architecture.html#adding-a-new-library-target","title":"Adding a New Library Target","text":"<pre><code>add_library(my_new_lib STATIC\n    source1.F90\n    source2.F90\n)\n\n# Set module directory\nset_target_properties(my_new_lib PROPERTIES\n    Fortran_MODULE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY}\n)\n\n# Include modules from other targets\ntarget_include_directories(my_new_lib PUBLIC\n    ${CMAKE_Fortran_MODULE_DIRECTORY}\n)\n\n# Link dependencies\ntarget_link_libraries(my_new_lib PUBLIC\n    schism_interface_common\n    ESMF::ESMF\n)\n</code></pre>"},{"location":"cmake-architecture.html#adding-an-optional-dependency","title":"Adding an Optional Dependency","text":"<pre><code>if(USE_OPTIONAL_LIB)\n    find_package(OptionalLib)\n    if(OptionalLib_FOUND)\n        target_link_libraries(my_target PUBLIC OptionalLib::OptionalLib)\n        target_compile_definitions(my_target PRIVATE USE_OPTIONAL_LIB)\n    endif()\nendif()\n</code></pre>"},{"location":"cmake-architecture.html#references","title":"References","text":"<ul> <li>CMake Fortran Support: https://cmake.org/cmake/help/latest/manual/cmake-language.7.html#fortran-modules</li> <li>ESMF Documentation: https://earthsystemmodeling.org/docs/</li> <li>SCHISM Manual: https://ccrm.vims.edu/schismweb/</li> </ul>"},{"location":"cmake-architecture.html#revision-history","title":"Revision History","text":"<ul> <li>2025-11: Initial architecture documentation</li> <li>Added shared source pattern for parallel build fixes</li> <li>Documented SCHISM dependency chain</li> <li>Added MPI library discovery</li> </ul>"},{"location":"installation.html","title":"Installation","text":"<p>Earth System Modeling Framework (ESMF) and National Unified Operational Prediction Capability (NUOPC) caps for SCHISM</p>"},{"location":"installation.html#prerequisites","title":"Prerequisites","text":"<ol> <li> <p>A development system including a Fortran and a C++ compiler, GNU make (&gt;= 3.82) and CMake, and an installation of a message passing (MPI) implementation and the NetCDF library consistent with your Fortran/C++ toolchain.</p> </li> <li> <p>Earth System Modeling Framework (ESMF): You need to have ESMF installed and an environment variable    <code>ESMFMKFILE</code> defined (via <code>setenv</code> or <code>export</code>) that points to your ESMF   installation.  For some system, you'd also need to amend the search path for libraries <code>LD_LIBRARY_PATH</code> to    include the ESMF library directory.   for example by issuing</p> </li> </ol> <pre><code>  setenv ESMFMKFILE /my/path/to/esmf/lib/libO/Linux.intel.64.openmpi.default/esmf.mk\n  setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:/my/path/to/esmf/lib/libO/Linux.intel.64.openmpi.default/\n</code></pre> <ol> <li>SCHISM: You need to have SCHISM built with <code>cmake</code> and an environment    variable <code>SCHISM_BUILD_DIR</code> defined that points to your SCHISM build    directory containing <code>lib/libhydro.a</code>, e.g.</li> </ol> <pre><code>setenv SCHISM_BUILD_DIR /my/path/to/schism/build\n</code></pre> <ol> <li>Optionally, you can have PDAF:</li> </ol> <p>```   setenv PDAF_LIB_DIR /my/path/to/pdaf/lib   ````</p>"},{"location":"installation.html#compilation-in-schism-esmf","title":"Compilation (in schism-esmf)","text":"<pre><code>make install-nuopc install-esmf \n</code></pre> <p>This will produce (1) the <code>libesmf_schism.a</code> <code>libschism_nuopc.a</code> library, which can be linked in other ESMF applications that want to include SCHISM as a component.  This is the primary application.</p>"},{"location":"installation.html#bugs-and-wishes","title":"Bugs and wishes","text":"<p>Please report bugs and any other issues or wishes on GitHub's issue tracker https://github.com/schism-dev/schism-esmf/issues (preferred) or by email to carsten.lemmen@hereon.de.  </p>"},{"location":"installation.html#contributing","title":"Contributing","text":"<p>You are very welcome to contribute to improving this cap. Fork on github, make changes, and file a pull request. </p> <p>As the primary license of SCHISM-ESMF is Apache 2.0, you're bound by its section 5 stating that your contribution also falls under Apache 2.0.  </p>"},{"location":"legal.html","title":"Legal aspects","text":"<p>The SCHISM-ESMF cap is free and open source.  You are welcome to use it in any way you like, you are encouraged to modify it and adapt it to your own purposes, and you are free to pass it on, within the bounds ofthe license terms set out below.</p>"},{"location":"legal.html#license","title":"License","text":"<p>The majority of codes of the SCHISM-ESMF cap are released under the Apache version 2.0 license</p> <p>Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> <p>http://www.apache.org/licenses/LICENSE-2.0</p> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p> <p>Those parts which were derived from third-party software under the terms of the GNU Public License, continue to be released under the GPL.</p> <p>This program is free software: you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation, either version 3 of the License, or    (at your option) any later version.</p> <p>This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.</p> <p>You should have received a copy of the GNU General Public License    along with this program.  If not, see https://www.gnu.org/licenses/.</p>"},{"location":"legal.html#copyright","title":"Copyright","text":"<p>The majority of codes of the SCHISM-ESMF cap are copyrighted by Helmholtz-Zentrum hereon GmbH (Hereon) and Virginia Institute of Marine Science (VIMS).  Any other contribution retains the copyright of the respective contributor.   </p>"},{"location":"legal.html#contributing","title":"Contributing","text":"<p>According to section 5 of SCHISM's Apache License, your contribution is accepted under the terms of the Apache 2.0 License, unless agreed otherwise.  If you modify codes that are under the therms of the GNU Public license, your contribution is accepted under those terms.</p> <p>By submitting your contribution, you acknowledge that you have the legal right to contribute your work to SCHISM-ESMF, and you hereby irrevocably grant to Hereon and VIMS a perpetual license to use, redistribute, and re-license your contribution under any open source license endorsed by the Open Software Initiative.</p>"},{"location":"quickstart.html","title":"Quick Start","text":"<p>This is a short landing page for the quick start. For the complete, step-by-step guide with platform-specific notes, see the full Quick Start document in the repository:</p> <ul> <li>View the full Quick Start: https://github.com/schism-dev/schism-esmf/blob/HEAD/QUICKSTART.md</li> </ul> <p>If you're browsing the MkDocs site, this link will open the repository version. Key steps in brief:</p> <ol> <li>Install ESMF with MPI (mpich or openmpi)</li> <li>Build SCHISM with CMake and export SCHISM_BUILD_DIR</li> <li>Configure and build schism-esmf with CMake</li> <li>Verify executables and run an example</li> </ol> <p>Troubleshooting? See Build Troubleshooting.</p>"},{"location":"running-examples.html","title":"Running SCHISM-ESMF Examples","text":"<p>This guide explains how to run the SCHISM-ESMF executables and set up example cases.</p>"},{"location":"running-examples.html#executables-overview","title":"Executables Overview","text":"<p>After building, two executables are created in <code>build/src/</code>:</p>"},{"location":"running-examples.html#main_esmf","title":"<code>main_esmf</code>","text":"<ul> <li>Purpose: ESMF-based SCHISM driver</li> <li>Use case: Standalone SCHISM runs with ESMF infrastructure</li> <li>Features: ESMF time management, ESMF State containers</li> <li>Configuration: Uses <code>esmf.rc</code> for ESMF-specific settings</li> </ul>"},{"location":"running-examples.html#main_nuopc","title":"<code>main_nuopc</code>","text":"<ul> <li>Purpose: NUOPC-based SCHISM driver with coupling capabilities</li> <li>Use case: Coupled earth system models (ocean-atmosphere, etc.)</li> <li>Features: NUOPC interoperability layer, multi-model coupling</li> <li>Configuration: Uses NUOPC field dictionaries and run sequences</li> </ul>"},{"location":"running-examples.html#required-input-files","title":"Required Input Files","text":"<p>Both executables require a standard SCHISM setup with these files:</p>"},{"location":"running-examples.html#core-schism-files","title":"Core SCHISM Files","text":"<ul> <li><code>param.nml</code> - Main SCHISM configuration</li> <li><code>vgrid.in</code> - Vertical grid definition</li> <li><code>hgrid.gr3</code> - Horizontal grid</li> <li><code>bctides.in</code> - Boundary conditions (if applicable)</li> <li><code>drag.gr3</code>, <code>manning.gr3</code> - Bottom friction parameters</li> </ul>"},{"location":"running-examples.html#esmfnuopc-specific-files","title":"ESMF/NUOPC-Specific Files","text":"<ul> <li>For <code>main_esmf</code>:</li> <li><code>esmf.rc</code> - ESMF configuration (optional)</li> <li> <p><code>schism_component.cfg</code> - SCHISM component settings</p> </li> <li> <p>For <code>main_nuopc</code>:</p> </li> <li><code>field_dictionary.yaml</code> - NUOPC field mappings</li> <li><code>schism_component.cfg</code> - Component configuration</li> </ul>"},{"location":"running-examples.html#running-examples","title":"Running Examples","text":""},{"location":"running-examples.html#example-1-quarter-annulus-test","title":"Example 1: Quarter Annulus Test","text":"<p>The Test_QuarterAnnulus example demonstrates basic SCHISM-ESMF functionality.</p> <pre><code>cd example/Test_QuarterAnnulus\n\n# Generate grid and setup\nmake setup\n\n# Run with ESMF driver\n../../build/src/main_esmf\n\n# Or run with NUOPC driver\n../../build/src/main_nuopc\n</code></pre> <p>What it does: - Creates a quarter-annulus domain - Sets up tidal forcing - Runs a short simulation (typically hours to days) - Outputs to <code>outputs/</code> directory</p> <p>Expected output files: - <code>outputs/schout_*.nc</code> - Model output (elevation, velocity, salinity, etc.) - <code>outputs/mirror.out</code> - Runtime log - <code>outputs/nonfatal_*</code> - Warning messages (if any)</p>"},{"location":"running-examples.html#example-2-heat-pool-test","title":"Example 2: Heat Pool Test","text":"<p>Tests temperature advection and diffusion.</p> <pre><code>cd example/Test_HeatPool\n\n# Run the example\nmake\n\n# Check results\nls outputs/\n</code></pre>"},{"location":"running-examples.html#example-3-cfl-test","title":"Example 3: CFL Test","text":"<p>Tests Courant-Friedrichs-Lewy condition handling.</p> <pre><code>cd example/cfl\n\n# Run the test\nmake\n\n# Analyze timestep adaptation\ngrep \"dt=\" outputs/mirror.out\n</code></pre>"},{"location":"running-examples.html#configuration-files-explained","title":"Configuration Files Explained","text":""},{"location":"running-examples.html#paramnml","title":"<code>param.nml</code>","text":"<p>Standard SCHISM namelist. Key parameters for ESMF runs:</p> <pre><code>&amp;CORE\n  dt = 100.0          ! Time step (seconds)\n  rnday = 1.0         ! Run duration (days)\n  start_year = 2000\n  start_month = 1\n  start_day = 1\n  start_hour = 0\n/\n\n&amp;OPT\n  ipre = 1            ! Pre-processing option\n  ibc = 1             ! Boundary condition type\n  ibtp = 1            ! Baroclinic/barotropic option\n/\n\n&amp;SCHOUT\n  nhot_write = 8640   ! Hotstart output frequency\n  iout_sta = 1        ! Station output\n  nspool_sta = 10     ! Station output frequency\n/\n</code></pre>"},{"location":"running-examples.html#schism_componentcfg","title":"<code>schism_component.cfg</code>","text":"<p>ESMF/NUOPC component configuration:</p> <pre><code>component_name: SCHISM\nmesh_file: hgrid.gr3\nstart_time: 2000-01-01T00:00:00\nstop_time: 2000-01-02T00:00:00\ntimestep: 100s\noutput_interval: 3600s\n</code></pre>"},{"location":"running-examples.html#field_dictionaryyaml-nuopc-only","title":"<code>field_dictionary.yaml</code> (NUOPC only)","text":"<p>Defines coupling fields:</p> <pre><code>sea_surface_height_above_geoid:\n  standard_name: sea_surface_height_above_geoid\n  canonical_units: m\n  description: Sea surface elevation relative to geoid\n\nsea_water_temperature:\n  standard_name: sea_water_temperature\n  canonical_units: K\n  description: Water temperature\n\nsea_water_velocity:\n  standard_name: sea_water_velocity\n  canonical_units: m s-1\n  description: Water velocity components\n</code></pre>"},{"location":"running-examples.html#running-with-mpi","title":"Running with MPI","text":"<p>Both executables support parallel execution:</p> <pre><code># Using mpirun\nmpirun -np 4 ../../build/src/main_esmf\n\n# Using mpiexec\nmpiexec -n 4 ../../build/src/main_nuopc\n\n# SLURM on HPC\nsrun -n 48 ../../build/src/main_esmf\n</code></pre> <p>MPI considerations: - Number of processors must be compatible with domain decomposition - SCHISM uses ParMETIS for optimal load balancing - See <code>param.nml</code> \u2192 <code>nproc_nd</code> and <code>nproc_ev</code> for processor distribution</p>"},{"location":"running-examples.html#creating-your-own-setup","title":"Creating Your Own Setup","text":""},{"location":"running-examples.html#1-prepare-grid-files","title":"1. Prepare Grid Files","text":"<pre><code># Create horizontal grid (use SMS, QGIS, or Python tools)\n# \u2192 hgrid.gr3\n\n# Create vertical grid\n# \u2192 vgrid.in\n\n# Generate boundary conditions\n# \u2192 bctides.in\n</code></pre>"},{"location":"running-examples.html#2-create-schism-configuration","title":"2. Create SCHISM Configuration","text":"<pre><code># Copy template\ncp example/Test_QuarterAnnulus/param.nml .\n\n# Edit for your domain\nvi param.nml\n</code></pre>"},{"location":"running-examples.html#3-create-esmf-configuration","title":"3. Create ESMF Configuration","text":"<pre><code># Copy ESMF config\ncp example/Test_QuarterAnnulus/schism_component.cfg .\n\n# For NUOPC coupling\ncp example/TripleSchism/field_dictionary.yaml .\n</code></pre>"},{"location":"running-examples.html#4-run","title":"4. Run","text":"<pre><code># Link executable\nln -s /path/to/build/src/main_esmf .\n\n# Execute\n./main_esmf\n</code></pre>"},{"location":"running-examples.html#debugging-runs","title":"Debugging Runs","text":""},{"location":"running-examples.html#check-for-errors","title":"Check for errors","text":"<pre><code># View runtime log\ntail -f outputs/mirror.out\n\n# Check for fatal errors\ngrep -i \"fatal\\|error\" outputs/mirror.out\n\n# Check for warnings\nls outputs/nonfatal_*\n</code></pre>"},{"location":"running-examples.html#common-issues","title":"Common issues","text":"<p>\"Cannot open file\": - Check that all required input files exist - Verify file paths in <code>param.nml</code></p> <p>\"MPI error\": - Ensure number of processors matches configuration - Check MPI is properly initialized</p> <p>\"Grid error\": - Validate grid files with SCHISM's <code>utility/Grid_Scripts/</code> - Check for negative depths, overlapping elements</p> <p>\"Timestep too large\": - Reduce <code>dt</code> in <code>param.nml</code> - Check CFL condition: <code>dt &lt; dx/c</code> where <code>c</code> is wave speed</p>"},{"location":"running-examples.html#output-analysis","title":"Output Analysis","text":""},{"location":"running-examples.html#netcdf-output","title":"NetCDF Output","text":"<p>SCHISM-ESMF produces CF-compliant NetCDF files:</p> <pre><code>import xarray as xr\n\n# Load output\nds = xr.open_dataset('outputs/schout_0001.nc')\n\n# View variables\nprint(ds.data_vars)\n\n# Plot elevation\nds.elevation.isel(time=0).plot()\n</code></pre>"},{"location":"running-examples.html#visualize-with-visit","title":"Visualize with VisIT","text":"<pre><code># Launch VisIT\nvisit\n\n# Open schout_*.nc files\n# Add plots: Pseudocolor, Vector, etc.\n</code></pre>"},{"location":"running-examples.html#use-schisms-post-processing-tools","title":"Use SCHISM's Post-processing Tools","text":"<pre><code>cd $SCHISM_DIR/utility/Post-Processing-Fortran/\n\n# Combine outputs\n./combine_output11 -i ../../outputs\n\n# Extract time series\n./read_output10_allnodes.f90\n</code></pre>"},{"location":"running-examples.html#performance-tips","title":"Performance Tips","text":"<ol> <li>Optimal processor count: Use powers of 2 or domain-compatible numbers</li> <li>I/O frequency: Balance between data needs and performance (<code>nspool</code> settings)</li> <li>Timestep: Largest stable <code>dt</code> improves performance</li> <li>Vertical layers: More layers = higher accuracy but slower</li> <li>Output variables: Only write needed variables (<code>iof_*</code> flags in <code>param.nml</code>)</li> </ol>"},{"location":"running-examples.html#advanced-coupled-runs","title":"Advanced: Coupled Runs","text":"<p>For coupling SCHISM with other models (atmosphere, wave, etc.):</p> <ol> <li>Use <code>main_nuopc</code> - provides NUOPC coupling layer</li> <li>Configure field dictionary - map fields between components</li> <li>Set up run sequence - define coupling timestepping</li> <li>Use ESMF_App - or create custom driver</li> </ol> <p>See <code>example/TripleSchism/</code> for multi-SCHISM coupling example.</p>"},{"location":"running-examples.html#troubleshooting-guide","title":"Troubleshooting Guide","text":"Issue Solution Segmentation fault Check array bounds, increase stack size (<code>ulimit -s unlimited</code>) NaN values Reduce timestep, check boundary conditions Slow performance Optimize processor count, reduce output frequency Missing output Check <code>iof_*</code> flags in <code>param.nml</code>, verify disk space Coupling errors Validate field dictionary, check unit conversions"},{"location":"running-examples.html#getting-help","title":"Getting Help","text":"<ul> <li>SCHISM documentation: https://ccrm.vims.edu/schismweb/</li> <li>ESMF user guide: https://earthsystemmodeling.org/docs/</li> <li>GitHub issues: https://github.com/schism-dev/schism-esmf/issues</li> <li>SCHISM forum: https://groups.google.com/g/schism-model-users</li> </ul>"},{"location":"running-examples.html#next-steps","title":"Next Steps","text":"<ul> <li>Explore <code>scripts/</code> directory for setup automation</li> <li>Review <code>Plot/</code> directory for visualization scripts</li> <li>Check <code>doc/</code> for detailed documentation</li> <li>Experiment with different model configurations</li> </ul> <p>Last updated: November 2025 Tested with: SCHISM 5.10+, ESMF 8.7-8.9</p>"}]}